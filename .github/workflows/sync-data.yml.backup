# âš ï¸ ì´ íŒŒì¼ì„ longrange-scraper ë¦¬í¬ì§€í† ë¦¬ì˜ .github/workflows/ í´ë”ì— ì¶”ê°€í•˜ì„¸ìš”
#
# ê²½ë¡œ: longrange-scraper/.github/workflows/sync-data.yml
#
# ì´ ì›Œí¬í”Œë¡œìš°ëŠ” ìŠ¤í¬ëž˜í•‘í•œ ë°ì´í„°ë¥¼ koungs-day-webì˜ public/data/ í´ë”ì— ìžë™ìœ¼ë¡œ ë™ê¸°í™”í•©ë‹ˆë‹¤.

name: Sync Data to koungs-day-web

on:
  # ìˆ˜ë™ ì‹¤í–‰ (ìœ ì§€)
  workflow_dispatch:

  # ìŠ¤í¬ëž˜í•‘ ì›Œí¬í”Œë¡œìš° ì™„ë£Œ í›„ ìžë™ ì‹¤í–‰ (ì¶”ê°€!)
  workflow_run:
    workflows: ["EV Quota Scraper", "EV Subsidy Scraper"]
    types:
      - completed

jobs:
  sync-data:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout longrange-scraper (í˜„ìž¬ ë¦¬í¬)
        uses: actions/checkout@v4
        with:
          path: scraper

      - name: Checkout koungs-day-web (ëŒ€ìƒ ë¦¬í¬)
        uses: actions/checkout@v4
        with:
          repository: koungsday/koungs-day-web
          token: ${{ secrets.PAT_TOKEN }}
          path: web

      - name: Copy data files
        run: |
          # public/data í´ë”ê°€ ì—†ìœ¼ë©´ ìƒì„±
          mkdir -p web/public/data

          # ë°ì´í„° íŒŒì¼ ë³µì‚¬ (ê²½ë¡œëŠ” ì‹¤ì œ ìŠ¤í¬ëž˜í¼ êµ¬ì¡°ì— ë§žê²Œ ìˆ˜ì •)
          cp scraper/data/subsidies.json web/public/data/
          cp scraper/data/quota.json web/public/data/

          # ë³µì‚¬ëœ íŒŒì¼ í™•ì¸
          echo "ðŸ“ Copied files:"
          ls -lh web/public/data/

      - name: Commit and push to koungs-day-web
        working-directory: web
        run: |
          git config user.name "GitHub Actions Bot"
          git config user.email "actions@github.com"

          git add public/data/

          # ë³€ê²½ì‚¬í•­ì´ ìžˆì„ ë•Œë§Œ ì»¤ë°‹
          if git diff --staged --quiet; then
            echo "âœ… No changes to commit"
          else
            git commit -m "chore: Auto-update scraper data

            - Updated subsidies.json
            - Updated quota.json

            Synced from koungsday/longrange-scraper @ ${{ github.sha }}"

            git push

            echo "âœ… Data synced successfully!"
          fi

# ðŸ”‘ ì„¤ì • ë°©ë²•:
#
# 1. GitHub Personal Access Token (PAT) ìƒì„±
#    - https://github.com/settings/tokens/new
#    - repo ê¶Œí•œ ë¶€ì—¬
#    - Fine-grained token ì¶”ì²œ (koungs-day-webë§Œ ì ‘ê·¼)
#
# 2. longrange-scraper ë¦¬í¬ì— Secret ì¶”ê°€
#    - Settings > Secrets and variables > Actions
#    - New repository secret: PAT_TOKEN = <ìƒì„±í•œ í† í°>
#
# 3. ì´ íŒŒì¼ì„ longrange-scraper/.github/workflows/sync-data.ymlì— ì¶”ê°€
#
# 4. í…ŒìŠ¤íŠ¸:
#    - Actions íƒ­ > Sync Data to koungs-day-web > Run workflow
